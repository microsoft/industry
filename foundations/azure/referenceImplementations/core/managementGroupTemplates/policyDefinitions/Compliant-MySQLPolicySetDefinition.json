{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "topLevelManagementGroupPrefix": {
            "type": "string",
            "defaultValue": "FSIDemo"
        }
    },
    "variables": {
        "scope": "[concat('/providers/Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'))]",
        "policies": {
            "policyDefinitions": [
                {
                    "properties": {
                        "displayName": "Enforce SSL connection should be enabled for MySQL database servers",
                        "mode": "Indexed",
                        "description": "Azure Database for MySQL supports connecting your Azure Database for MySQL server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.",
                        "metadata": {
                            "version": "1.0.1",
                            "category": "MySQL"
                        },
                        "parameters": {
                            "effect": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                },
                                "allowedValues": [
                                    "Audit",
                                    "Deny",
                                    "Disabled"
                                ],
                                "defaultValue": "Audit"
                            }
                        },
                        "policyRule": {
                            "if": {
                                "allOf": [
                                    {
                                        "field": "type",
                                        "equals": "Microsoft.DBforMySQL/servers"
                                    },
                                    {
                                        "field": "Microsoft.DBforMySQL/servers/sslEnforcement",
                                        "exists": "true"
                                    },
                                    {
                                        "field": "Microsoft.DBforMySQL/servers/sslEnforcement",
                                        "notEquals": "Enabled"
                                    }
                                ]
                            },
                            "then": {
                                "effect": "[[parameters('effect')]"
                            }
                        }
                    },
                    "name": "Deny-MySql-SSL-Connection"
                },
                {
                    "properties": {
                        "policyType": "Custom",
                        "mode": "Indexed",
                        "displayName": "Azure Database for MySQL server deploy a specific min TLS version and enforce SSL.",
                        "description": "Deploy a specific min TLS version requirement and enforce SSL on Azure Database for MySQL server. Enforce the Server to client applications using minimum version of Tls to secure the connection between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application. This configuration enforces that SSL is always enabled for accessing your database server.",
                        "metadata": {
                            "version": "1.0.0",
                            "category": "MySQL"
                        },
                        "parameters": {
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect minimum TLS version Azure Database for MySQL server",
                                    "description": "Enable or disable the execution of the policy minimum TLS version Azure Database for MySQL server"
                                }
                            },
                            "minimalTlsVersion": {
                                "type": "String",
                                "defaultValue": "TLS1_2",
                                "allowedValues": [
                                    "TLS1_2",
                                    "TLS1_0",
                                    "TLS1_1",
                                    "TLSEnforcementDisabled"
                                ],
                                "metadata": {
                                    "displayName": "Select version minimum TLS for MySQL server",
                                    "description": "Select version  minimum TLS version Azure Database for MySQL server to enforce"
                                }
                            }
                        },
                        "policyRule": {
                            "if": {
                                "allOf": [
                                    {
                                        "field": "type",
                                        "equals": "Microsoft.DBforMySQL/servers"
                                    },
                                    {
                                        "anyOf": [
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/sslEnforcement",
                                                "notEquals": "Enabled"
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/minimalTlsVersion",
                                                "notequals": "[parameters('minimalTlsVersion')]"
                                            }
                                        ]
                                    }
                                ]
                            },
                            "then": {
                                "effect": "[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.DBforMySQL/servers",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/sslEnforcement",
                                                "equals": "Enabled"
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/minimalTlsVersion",
                                                "equals": "[parameters('minimalTlsVersion')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "minimalTlsVersion": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DBforMySQL/servers",
                                                        "apiVersion": "2017-12-01",
                                                        "name": "[concat(parameters('resourceName'))]",
                                                        "location": "[parameters('location')]",
                                                        "properties": {
                                                            "sslEnforcement": "[if(equals(parameters('minimalTlsVersion'), 'TLSEnforcementDisabled'),'Disabled', 'Enabled')]",
                                                            "minimalTlsVersion": "[parameters('minimalTlsVersion')]"
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "resourceName": {
                                                    "value": "[field('name')]"
                                                },
                                                "minimalTlsVersion": {
                                                    "value": "[parameters('minimalTlsVersion')]"
                                                },
                                                "location": {
                                                    "value": "[field('location')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Enforce-MySql-TlsVersion"
                },
                {
                    "properties": {
                        "policyType": "Custom",
                        "mode": "Indexed",
                        "displayName": "Deploy Diagnostic Settings for Database for MySQL to Log Analytics workspace",
                        "description": "Deploys the diagnostic settings for Database for MySQL to stream to a Log Analytics workspace when any Database for MySQL which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "metadata": {
                            "version": "1.0.0",
                            "category": "MySQL"
                        },
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setbypolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforMySQL/servers"
                            },
                            "then": {
                                "effect": "[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "[parameters('profileName')]",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DBforMySQL/servers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "categoryGroup": "allLogs",
                                                                    "enabled": true
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Dine-Diagnostics-MySql"
                },
                {
                    "properties": {
                        "displayName": "Deny MySQL servers without customer-managed keys to encrypt data at rest",
                        "policyType": "Custom",
                        "mode": "Indexed",
                        "description": "Use customer-managed keys to manage the encryption at rest of your MySQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.",
                        "metadata": {
                            "version": "1.0.5",
                            "category": "MySQL"
                        },
                        "parameters": {
                            "effect": {
                                "type": "string",
                                "defaultValue": "Deny",
                                "allowedValues": [
                                    "AuditIfNotExists",
                                    "Disabled",
                                    "Deny"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            }
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforMySQL/servers"
                            },
                            "then": {
                                "effect": "[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.DBforMySQL/servers/keys",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/keys/serverKeyType",
                                                "equals": "AzureKeyVault"
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/keys/uri",
                                                "notEquals": ""
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/servers/keys/uri",
                                                "exists": "true"
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deny-MySql-Without-CMK"
                },
                {
                    "properties": {
                        "displayName": "Deny MySQL Flexible servers without customer-managed keys to encrypt data at rest",
                        "policyType": "Custom",
                        "mode": "Indexed",
                        "description": "Use customer-managed keys to manage the encryption at rest of your MySQL Flexible servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.",
                        "metadata": {
                            "version": "1.0.0",
                            "category": "MySQL"
                        },
                        "parameters": {
                            "effect": {
                                "type": "string",
                                "defaultValue": "Deny",
                                "allowedValues": [
                                    "AuditIfNotExists",
                                    "Disabled",
                                    "Deny"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            }
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforMySQL/flexibleServers"
                            },
                            "then": {
                                "effect": "[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.DBforMySQL/flexibleServers/keys",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.DBforMySQL/flexibleServers/keys/serverKeyType",
                                                "equals": "AzureKeyVault"
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/flexibleServers/keys/uri",
                                                "notEquals": ""
                                            },
                                            {
                                                "field": "Microsoft.DBforMySQL/flexibleServers/keys/uri",
                                                "exists": "true"
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deny-MySql-FlexibleServers-Without-CMK"
                },
                {
                    "properties": {
                        "properties": {
                            "displayName": "Deny MySQL without An Azure Active Directory administrator",
                            "policyType": "BuiltIn",
                            "mode": "Indexed",
                            "description": "Deny provisioning of an Azure Active Directory administrator for your MySQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services",
                            "metadata": {
                                "version": "1.0.0",
                                "category": "MySQL"
                            },
                            "parameters": {
                                "effect": {
                                    "type": "string",
                                    "defaultValue": "Deny",
                                    "allowedValues": [
                                        "AuditIfNotExists",
                                        "Disabled",
                                        "Deny"
                                    ],
                                    "metadata": {
                                        "displayName": "Effect",
                                        "description": "Enable or disable the execution of the policy"
                                    }
                                }
                            },
                            "policyRule": {
                                "if": {
                                    "field": "type",
                                    "equals": "Microsoft.DBforPostgreSQL/servers"
                                },
                                "then": {
                                    "effect": "[parameters('effect')]",
                                    "details": {
                                        "type": "Microsoft.DBforPostgreSQL/servers/administrators"
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deny-MySql-Without-Aad-Admin"
                },
                {
                    "properties": {
                        "properties": {
                            "displayName": "Private endpoint should be enabled for MySQL servers",
                            "policyType": "BuiltIn",
                            "mode": "Indexed",
                            "description": "Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.",
                            "metadata": {
                                "version": "1.0.3",
                                "category": "MySQL"
                            },
                            "parameters": {
                                "effect": {
                                    "type": "string",
                                    "defaultValue": "AuditIfNotExists",
                                    "allowedValues": [
                                        "AuditIfNotExists",
                                        "Disabled",
                                        "Deny"
                                    ],
                                    "metadata": {
                                        "displayName": "Effect",
                                        "description": "Enable or disable the execution of the policy"
                                    }
                                }
                            },
                            "policyRule": {
                                "if": {
                                    "field": "type",
                                    "equals": "Microsoft.DBforMySQL/servers"
                                },
                                "then": {
                                    "effect": "[parameters('effect')]",
                                    "details": {
                                        "type": "Microsoft.DBforMySQL/servers/privateEndpointConnections",
                                        "existenceCondition": {
                                            "field": "Microsoft.DBforMySQL/servers/privateEndpointConnections/privateLinkServiceConnectionState.status",
                                            "equals": "Approved"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deny-MySql-Public-Endpoint"
                }
            ]
        }
    },
    "resources": [
        {
            "type": "Microsoft.Authorization/policyDefinitions",
            "name": "[variables('policies').policyDefinitions[copyIndex()].name]",
            "apiVersion": "2019-09-01",
            "copy": {
                "name": "policyDefinitionCopy",
                "count": "[length(variables('policies').policyDefinitions)]"
            },
            "properties": {
                "displayName": "[variables('policies').policyDefinitions[copyIndex()].properties.displayName]",
                "description": "[variables('policies').policyDefinitions[copyIndex()].properties.description]",
                "mode": "[variables('policies').policyDefinitions[copyIndex()].properties.mode]",
                "policyType": "Custom",
                "parameters": "[variables('policies').policyDefinitions[copyIndex()].properties.parameters]",
                "policyRule": "[variables('policies').policyDefinitions[copyIndex()].properties.policyRule]",
                "metadata": "[variables('policies').policyDefinitions[copyIndex()].properties.metadata]"
            }
        },
        {
            "type": "Microsoft.Authorization/policySetDefinitions",
            "apiVersion": "2021-06-01",
            "name": "Compliant-MySQL",
            "dependsOn": [
                "policyDefinitionCopy"
            ],
            "properties": {
                "metadata": {
                    "version": "1.0.0",
                    "category": "MySQL"
                },
                "displayName": "Enforce secure-by-default MySQL for Financial Services Industry",
                "description": "This policy initiative is a group of policies that ensures MySQL is compliant per FSI Landing Zones",
                "policyDefinitionGroups": [
                    {
                        "name": "Encryption",
                        "category": "Data Protection",
                        "displayName": "Ensure MySQL is using secure encryption",
                        "description": "Policy to ensure MySQL is using secure encryption"
                    },
                    {
                        "name": "Network",
                        "category": "Network Security",
                        "displayName": "Ensure MySQL is not accessible over the public internet",
                        "description": "Policy to ensure MySQL is not accessible over the public internet"
                    },
                    {
                        "name": "Identity",
                        "category": "Identity Management",
                        "displayName": "Ensure usage of centralized identity and auhtorization system for MySQL",
                        "description": "Policy to ensure MySQL is not using local authorization"
                    },
                    {
                        "name": "Logging",
                        "category": "Logging and Threat Detection",
                        "displayName": "Ensure MySQL is logging all events to Log Analytics",
                        "description": "Policy to ensure MySQL is logging all events to Log Analytics workspace"
                    }
                ],
                "parameters": {
                    "mySqlInfraEncryption": {
                        "type": "string",
                        "defaultValue": "Deny"
                    },
                    "mySqlAdvThreatProtection": {
                        "type": "string",
                        "defaultValue": "DeployIfNotExists"
                    },
                    "mySqlFlexiblePublicNetworkAccess": {
                        "type": "string",
                        "defaultValue": "Deny"
                    },
                    "mySqlPublicNetworkAccess": {
                        "type": "string",
                        "defaultValue": "Deny"
                    },
                    "mySqlSsl": {
                        "type": "string",
                        "defaultValue": "Deny"
                    },
                    "mySqlminimalTlsVersion": {
                        "type": "string",
                        "defaultValue": "TLS1_2"
                    },
                    "mySqlDiagnostics": {
                        "type": "string",
                        "defaultValue": "DeployIfNotExists"
                    },
                    "mySqlDiagnosticsLogAnalyticsWorkspaceId": {
                        "type": "string",
                        "defaultValue": ""
                    },
                    "mySqlWithoutCMKEffect": {
                        "type": "string"
                    },
                    "mySqlFlexibleServerWithoutCMKEffect": {
                        "type": "string"
                    },
                    "mySqlAadAdminffect": {
                        "type": "string"
                    },
                    "mySqlManagedPublicNetworkAccess": {
                        "type": "string"
                    }
                },
                "policyDefinitions": [
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[0].name)]",
                        "policyDefinitionReferenceId": "Deny-MySql-Ssl",
                        "groupNames": [
                            "Encryption"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlSsl')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[1].name)]",
                        "policyDefinitionReferenceId": "Enforce-MySql-TlsVersion",
                        "groupNames": [
                            "Encryption"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlminimalTlsVersion')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[2].name)]",
                        "policyDefinitionReferenceId": "Dine-Diagnostics-MySql",
                        "groupNames": [
                            "Logging"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlDiagnostics')]"
                            },
                            "logAnalytics": {
                                "value": "[[parameters('mySqlDiagnosticsLogAnalyticsWorkspaceId')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/d9844e8a-1437-4aeb-a32c-0c992f056095",
                        "policyDefinitionReferenceId": "Deny-MySql-Public-Network-Access",
                        "groupNames": [
                            "Network"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlPublicNetworkAccess')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c9299215-ae47-4f50-9c54-8a392f68a052",
                        "policyDefinitionReferenceId": "Deny-MySql-Flex-Public-Network-Access",
                        "groupNames": [
                            "Network"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlFlexiblePublicNetworkAccess')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/80ed5239-4122-41ed-b54a-6f1fa7552816",
                        "policyDefinitionReferenceId": "Dine-MySql-Adv-Threat-Protection",
                        "groupNames": [
                            "Logging"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlAdvThreatProtection')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/3a58212a-c829-4f13-9872-6371df2fd0b4",
                        "policyDefinitionReferenceId": "Deny-MySql-Infra-Encryption",
                        "groupNames": [
                            "Encryption"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlInfraEncryption')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[3].name)]",
                        "policyDefinitionReferenceId": "Deny-MySql-Without-CMK",
                        "groupNames": [
                            "Encryption"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlWithoutCMKEffect')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[4].name)]",
                        "policyDefinitionReferenceId": "Deny-MySql-FlexibleServers-Without-CMK",
                        "groupNames": [
                            "Encryption"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlFlexibleServerWithoutCMKEffect')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[5].name)]",
                        "policyDefinitionReferenceId": "Deny-MySql-Without-Aad-Admin",
                        "groupNames": [
                            "Identity"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlAadAdminffect')]"
                            }
                        }
                    },
                    {
                        "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/', variables('policies').policyDefinitions[6].name)]",
                        "policyDefinitionReferenceId": "Deny-MySql-Public-Endpoint",
                        "groupNames": [
                            "Network"
                        ],
                        "parameters": {
                            "effect": {
                                "value": "[[parameters('mySqlManagedPublicNetworkAccess')]"
                            }
                        }
                    }
                ]
            }
        }
    ]
}