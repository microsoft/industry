{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "AfO Landing Zones",
            "isWizard": false,
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment location",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope"
                        }
                    ]
                },
                {
                    "name": "lzSettings",
                    "label": "Management Group and Subscription Organization",
                    "subLabel": {
                        "preValidation": "Provide a prefix for the management group structure that will be created.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Company prefix",
                    "elements": [
                        {
                            "name": "info",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "AfO Landing Zones requires access at the tenant root (/) scope. Visit this link to ensure you have the appropriate RBAC permission to complete the deployment",
                                "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "mgSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Management Groups",
                            "elements": [
                                {
                                    "name": "mgmtGroup",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "AfO Landing Zones will create the management group hierarchy under the Tenant Root Group with the prefix provided at this step, which will be used to establish a proven architecture for subscription organization and policy driven governance at scale.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/tree/main/fsi#fsi-landing-zones-on-microsoft-azure"
                                        }
                                    }
                                },
                                {
                                    "name": "esMgmtGroup",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Management Group prefix",
                                    "toolTip": "Provide a prefix (max 10 characters, unique at tenant-scope) for the Management Group hierarchy and other resources created as part of AfO Landing Zones.",
                                    "defaultValue": "",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,10}$",
                                        "validationMessage": "The prefix must be 1-10 characters."
                                    }
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "rpRegistrationApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "POST",
                                "path": "[concat('/providers/Microsoft.Management/managementGroups/',steps('basics').resourceScope.tenant.tenantId, '/providers/Microsoft.PolicyInsights/register?api-version=2021-04-01')]"
                            }
                        },
                        {
                            "name": "subSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Subscription Organization",
                            "elements": [
                                {
                                    "name": "subOrg",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "AfO Landing Zones recommends dedidated subscriptions for the Azure platform functionality, such as Security, Governance, Compliance, Network Connectivity, and Identity and Access. This enables the organization to scale the Azure platform and the workloads in the landing zones independently regardless of future scale-point.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/blob/main/fsi/docs/architectureAndDesign.md#architecture-and-design"
                                        }
                                    }
                                },
                                {
                                    "name": "subOrgsOption",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select dedicated subscriptions or a single subscription for AfO Landing Zones platform resources",
                                    "defaultValue": "Dedicated (recommended)",
                                    "toolTip": "Dedicated subscriptions will require separate Azure subscriptions for platform resources and is the recommended option for production environments. The single subscription option will deploy all platform resources on a single subscription.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Dedicated (recommended)",
                                                "value": "Dedicated"
                                            },
                                            {
                                                "label": "Single",
                                                "value": "Single"
                                            }
                                        ]
                                    },
                                    "visible": true
                                }
                            ],
                            "visible": false
                        },
                        {
                            "name": "esSingleSubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Single platform subscription",
                            "elements": [
                                {
                                    "name": "subWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "icon": "Warning",
                                        "text": "Dedicated subscriptions are recommended for the various platform components to ensure scale, sustainability, and segregation of duties, and especially around networking. However, a single subscription can also be used in case this is not a concern (e.g., small organizations, or testing purposes).",
                                        "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                                    }
                                },
                                {
                                    "name": "singleSubText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the single subscription that will be used for all platform resources during deployment, for security, logging, connectivity, and identity."
                                    }
                                },
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esSingleSub",
                                    "label": "Single platform subscription"
                                }
                            ],
                            "visible": "[equals(steps('lzSettings').subSection.subOrgsOption, 'Single')]"
                        }
                    ]
                },
                {
                    "name": "esGoalState",
                    "label": "Management and Monitoring",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzGs",
                    "elements": [
                        {
                            "name": "multiPlatformMgmtSub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]",
                            "options": {
                                "text": "To enable platform management and monitoring, you must allocate a dedicated Azure Subscription. Please note, this Subscription will be moved to the platform Management Group, and ARM will deploy a Log Analytics workspace and requisite settings. We recommend using a new Subscription with no existing resources. Note that Azure Policy will be used to govern the configuration for the platform at scale.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "singlePlatformMgmtSub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[equals(steps('lzSettings').subSection.subOrgsOption, 'Single')]",
                            "options": {
                                "text": "To enable management and monitoring, you can configure core infra such as Log Analytics and additional monitoring solutions to your dedicated platform subscription. Note that Azure Policy will be used to govern the configuration for the platform at scale.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "esMgmtSubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Management subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esMgmtSub",
                                    "label": "Management subscription"
                                }
                            ],
                            "visible": "[and(equals(steps('esGoalState').azMonSection.esLogAnalytics, 'Yes'), not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single')))]"
                        },
                        {
                            "name": "azMonSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure Monitor",
                            "elements": [
                                {
                                    "name": "azMonText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Azure Monitor with Log Analytics provides the core infrastructure to enable platform observability, security, and log retention for the AfO Landing Zones. You can create a dedicated Log Analytics workspace and enable curated analytical solutions, that will also intersect with Microsoft Defender for Cloud and Microsoft Sentinel.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://learn.microsoft.com/azure/azure-monitor/logs/log-analytics-overview"
                                        }
                                    }
                                },
                                {
                                    "name": "esLogAnalytics",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Log Analytics workspace and enable monitoring for your platform and resources",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, Log Analytics workspace will be created in the dedicated subscription and enable additional configuration options in the deployment wizard.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": true
                                },
                                {
                                    "name": "esLogRetention",
                                    "type": "Microsoft.Common.Slider",
                                    "min": 30,
                                    "max": 730,
                                    "label": "Log Analytics Data Retention (days)",
                                    "subLabel": "Days",
                                    "defaultValue": 30,
                                    "showStepMarkers": false,
                                    "toolTip": "Select retention days for Azure logs. Default is 30 days. If longer retention is required, you can optionally configure Log Analytics data export to a Storage Account or an Event Hub namespace.",
                                    "constraints": {
                                        "required": false
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esEventHub",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Enable Log Analytics Data Export to Event Hub for SIEM integration",
                                    "defaultValue": "No",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, Log Analytics workspace will be created in the dedicated subscription and enable additional configuration options in the deployment wizard.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esEventHubDataExports",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Enable Log Analytics Data Export to Event Hub for SIEM integration",
                                    "defaultValue": [
                                        "Security Alert",
                                        "Security Event",
                                        "Security Incident"
                                    ],
                                    "multiselect": true,
                                    "multiLine": true,
                                    "selectAll": true,
                                    "defaultDescription": "Select the tables you want to export to Event Hub",
                                    "filter": true,
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, Log Analytics workspace will be created in the dedicated subscription and enable additional configuration options in the deployment wizard.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Security Alert",
                                                "description": "Table used by Defender for Cloud and Microsoft Sentinel for alerts",
                                                "value": "SecurityAlert"
                                            },
                                            {
                                                "label": "Security Baseline",
                                                "description": "Table used by Defender for Cloud security baseline for Virtual Machines, VMWare, Azure Stack HCI, SCVMM, and Virtual Machine Scale Sets",
                                                "value": "SecurityBaseline"
                                            },
                                            {
                                                "label": "Security Baseline Summary",
                                                "description": "Table used by Defender for Cloud security baseline summary for Virtual Machines, VMWare, Azure Stack HCI, and SCVMM",
                                                "value": "SecurityBaselineSummary"
                                            },
                                            {
                                                "label": "Security Detection",
                                                "description": "Table used by Security and Audit solution for Log Analytics workspace",
                                                "value": "SecurityDetection"
                                            },
                                            {
                                                "label": "Security Event",
                                                "description": "Table used by Security and Audit solution for Log Analytics workspace and Microsoft Sentinel",
                                                "value": "SecurityEvent"
                                            },
                                            {
                                                "label": "Security Incident",
                                                "description": "Table used by Microsoft Sentinel",
                                                "value": "SecurityIncident"
                                            },
                                            {
                                                "label": "Security Recommendation",
                                                "description": "Table used by Defender for Cloud and Security and Audit solution for Log Analytics workspace",
                                                "value": "SecurityRecommendation"
                                            },
                                            {
                                                "label": "Sentinel Audit",
                                                "description": "Table used by Microsoft Sentinel",
                                                "value": "SentinelAudit"
                                            },
                                            {
                                                "label": "Sentinel Health",
                                                "description": "Table used by Microsoft Sentinel",
                                                "value": "SentinelHealth"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esEventHub,'Yes')]"
                                },
                                {
                                    "name": "monitoring",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]",
                                    "options": {
                                        "text": "Select which Azure Monitor solutions you will enable for your Log Analytics workspace",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                                        }
                                    }
                                },
                                {
                                    "name": "esAgentSolution",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Agent Health solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esChangeTracking",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Change Tracking solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esUpdateMgmt",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Update Management solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esActivityLog",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Activity Log solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esVmInsights",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy VM Insights solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esServiceMap",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy Service Map solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                },
                                {
                                    "name": "esSqlAssessment",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Deploy SQL Assessment solution",
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                                }
                            ],
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "esGovState",
                    "label": "Security, Governance, and Compliance",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzGovernance",
                    "elements": [
                        {
                            "name": "govInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "To enable platform security, governance, and compliance, you can configure Microsoft Cloud Security Benchmark, Compliant and Secure by-default Azure services, Microsoft Defender for Cloud, and additional governance solutions. Note that Azure Policy will be used to govern the configuration for the platform at scale.",
                                "uri": "https://learn.microsoft.com/security/benchmark/azure/overview",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "asbSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Microsoft Cloud Security Benchmark",
                            "elements": []
                        },
                        {
                            "name": "mcsbText",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "The Microsoft Cloud Security Benchmark focuses on cloud-centric control areas. These controls are consistent with well-known security benchmarks, such as those described by the Center for Internet Security (CIS) Controls, National Institute of Standards and Technology (NIST), and Payment Card Industry Data Security Standard (PCI-DSS).",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://learn.microsoft.com/security/benchmark/azure/overview"
                                }
                            }
                        },
                        {
                            "name": "mcsbPolicy",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Assign Microsoft Cloud Security Benchmark Policy Initiative",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, the MCSB will be assigned at the intermediate root management group to provide an aggregated compliance view for the AfO Landing Zones architecture.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "secureByDefaultSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Compliant and Secure by-default",
                            "elements": []
                        },
                        {
                            "name": "secureByDefaultText",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "AfO Landing Zones enables a 'compliant and secure by-default' landing zones for your Azure services. Select the Azure services you want to have enforced as 'secure by-default' via Azure policy to satisfy regulatory requirements. The services you select are the only one that can be deployed to the landing zones, in the Azure regions you have enabled during this deployment.",
                                "link": {
                                    "label": "Learn more about 'secure by-default' for AfO Landing Zones",
                                    "uri": "https://github.com/microsoft/industry/blob/main/fsi/docs/securityGovernanceAndCompliance.md#compliant-and-secure-by-default-fsi-landing-zones"
                                }
                            }
                        },
                        {
                            "name": "secureSvc",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Secure by-default Azure Services",
                            "placeholder": "",
                            "defaultValue": [
                                "API Management",
                                "App Service",
                                "Automation",
                                "Backup",
                                "Cognitive Search",
                                "Compute",
                                "Container Apps",
                                "Container Instance",
                                "Container Registry",
                                "Cosmos DB",
                                "Data Explorer",
                                "Data Factory",
                                "Event Grid",
                                "Event Hub",
                                "Key Vault",
                                "Kubernetes",                                
                                "Machine Learning",
                                "Networking", 
                                "Open AI",
                                "Postgre SQL",                                                                
                                "Service Bus",
                                "SQL",
                                "Storage Account",
                                "Synapse",
                                "Virtual Desktop"
                            ],
                            "toolTip": "",
                            "multiselect": true,
                            "selectAll": true,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": true,
                            "defaultDescription": "Select the Azure services that must be secure by-default",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "API Management",
                                        "description": "Azure policies will ensure secure by-default compliance for API Management, such as enforcement of strong protocols, encryption, access via private endpoint, and centralized logging.",
                                        "value": "Apim"
                                    },
                                    {
                                        "label": "App Service",
                                        "description": "Azure policies will ensure secure by-default compliance for App Service (including Function Apps), such as enforcement of strong protocols, access via private endpoint, and centralized logging.",
                                        "value": "AppService"
                                    },
                                    {
                                        "label": "Automation",
                                        "description": "Azure policies will ensure secure by-default compliance for Automation accounts, enforce access via private endpoints, encyrption of variables and centralized logging.",
                                        "value": "Automation"
                                    },
                                    {
                                        "label": "Backup",
                                        "description": "Azure policies will ensure secure by-default compliance for Backup and Recovery Services vaults, enforce immutable backups, encryption, and private over private endpoint.",
                                        "value": "Backup"
                                    },
                                    {
                                        "label": "Cognitive Search",
                                        "description": "Azure policies will ensure secure by-default compliance for Cognitive Search, enforce access via private endpoints, encyrption of variables and centralized authorization.",
                                        "value": "CognitiveSearch"
                                    },
                                    {
                                        "label": "Compute",
                                        "description": "Azure policies will ensure secure by-default compliance for Compute, enforce access via private endpoints, encyrption of variables and centralized authorization.",
                                        "value": "Compute"
                                    },
                                    {
                                        "label": "Container Apps",
                                        "description": "Azure policies will ensure secure by-default compliance for Container Apps, enforce access via private endpoints, encyrption of variables and centralized authorization.",
                                        "value": "ContainerApps"
                                    },
                                    {
                                        "label": "Container Instance",
                                        "description": "Azure policies will ensure secure by-default compliance for Container Instance, enforce access via private endpoints, encyrption of variables and centralized authorization.",
                                        "value": "ContainerInstance"
                                    },
                                    {
                                        "label": "Container Registry",
                                        "description": "Azure policies will ensure secure by-default compliance for Container Registry, enforce access via private endpoints, encyrption of variables and centralized authorization.",
                                        "value": "ContainerRegistry"
                                    },
                                    {
                                        "label": "Cosmos DB",
                                        "description": "Azure policies will ensure secure by-default compliance for Cosmos DB, enforce access via private endpoints, double encryption, centralized authorization, and centralized logging.",
                                        "value": "CosmosDb"
                                    },
                                    {
                                        "label": "Data Explorer",
                                        "description": "Azure policies will ensure secure by-default compliance for Data Explorer, enforce access via private endpoints, double encryption, centralized authorization, and centralized logging.",
                                        "value": "DataExplorer"
                                    },
                                    {
                                        "label": "Data Factory",
                                        "description": "Azure policies will ensure secure by-default compliance for Data Factory, enforce access via private endpoints, double encryption, centralized authorization, and centralized logging.",
                                        "value": "DataFactory"
                                    },
                                    {
                                        "label": "Event Grid",
                                        "description": "Azure policies will ensure secure by-default compliance for Event Grid, enforce access via private endpoints, centralized authorization, and centralized logging.",
                                        "value": "EventGrid"
                                    },
                                    {
                                        "label": "Event Hub",
                                        "description": "Azure policies will ensure secure by-default compliance for Event Hub, enforce access via private endpoints, centralized authorization, and centralized logging.",
                                        "value": "EventHub"
                                    },
                                    {
                                        "label": "Key Vault",
                                        "description": "Azure policies will ensure secure by-default compliance for Key Vaults, secrets, keys, and certificates, enforce access via private endpoints, purge protection, and centralized logging.",
                                        "value": "KeyVault"
                                    },
                                    {
                                        "label": "Kubernetes",
                                        "description": "Azure policies will ensure secure by-default compliance for Kubernetes (AKS), secrets, keys, and certificates, enforce access via private endpoints, centralized authorization and governance, and centralized logging.",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "label": "Machine Learning",
                                        "description": "Azure policies will ensure secure by-default compliance for Machine Learning, enforce access via private endpoints, centralized authorization, and centralized logging.",
                                        "value": "MachineLearning"
                                    },
                                    {
                                        "label": "Networking",
                                        "description": "Azure policies will ensure secure by-default compliance for Networking, such as enforcement of strong protocols, encryption, advanced threat protection, communication paths, and logging.",
                                        "value": "Networking"
                                    },
                                    
                                    {
                                        "label": "Open AI",
                                        "description": "Azure policies will ensure secure by-default compliance for Open AI, enforce access via private endpoints, centralized authorization, and centralized logging.",
                                        "value": "OpenAi"
                                    },
                                    {
                                        "label": "Postgre SQL",
                                        "description": "Azure policies will ensure secure by-default compliance for Postgre SQL, enforce access via private endpoints, centralized authorization, advanced threat protection and centralized logging.",
                                        "value": "PostgreSql"
                                    },
                                    {
                                        "label": "Service Bus",
                                        "description": "Azure policies will ensure secure by-default compliance for Service Bus, enforce access via private endpoints, double encryption, centralized authorization, and centralized logging.",
                                        "value": "ServiceBus"
                                    },
                                    {
                                        "label": "SQL",
                                        "description": "Azure policies will ensure secure by-default compliance for SQL servers and SQL databases, enforce access via private endpoints, centralized authorization, advanced threat protection and centralized logging.",
                                        "value": "Sql"
                                    },
                                    {
                                        "label": "Storage Account",
                                        "description": "Azure policies will ensure secure by-default compliance for Storage Accounts, such as enforcement of strong protocols, encryption, access via private endpoint, centralized authorization using Azure AD, and centralized logging.",
                                        "value": "StorageAccount"
                                    },
                                    {
                                        "label": "Synapse",
                                        "description": "Azure policies will ensure secure by-default compliance for Synapse, enforce access via private endpoints, double encryption, centralized authorization, and centralized logging.",
                                        "value": "Synapse"
                                    },
                                    {
                                        "label": "Virtual Desktop",
                                        "description": "Azure policies will ensure secure by-default compliance for Virtual Desktop, enforce access via private endpoints, centralized authorization, and centralized logging.",
                                        "value": "DesktopVirtualization"
                                    }
                                ],
                                "required": false
                            },
                            "visible": true
                        },
                        {
                            "name": "mcDefenderSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Microsoft Defender for Cloud",
                            "elements": [],
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                        },
                        {
                            "name": "mcDefenderText",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]",
                            "options": {
                                "text": "Select which Microsoft Defender for Cloud solutions you will enable.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/azure/security/fundamentals/overview"
                                }
                            }
                        },
                        {
                            "name": "defenderEndpoint",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Microsoft Defender for Endpoint for Windows and Linux VMs",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will enforce Defender for Endpoint for Windows and Linux VMs",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                        },
                        {
                            "name": "esAsc",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Microsoft Defender for Cloud and enable security monitoring for your platform and resources",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, Azure Policy will enforce Defender for Cloud and enable security monitoring for your platform and resources",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                        },
                        {
                            "name": "esAscEmail",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Microsoft Defender for Cloud Email Contact",
                            "toolTip": "Email address to get email notifications from Azure Security Center",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "defaultValue": "",
                            "constraints": {
                                "required": "[equals(steps('esGovState').esAsc,'Yes')]",
                                "regex": "^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$",
                                "validationMessage": "Please provide a valid email address"
                            }
                        },
                        {
                            "name": "esAscVms",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for servers",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for all servers.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscOssDb",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for open-source relational databases",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for open-source relational databases.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscCSPM",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for CSPM",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for CSPM.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscApim",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for API Management",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for APIM.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscCosmosDb",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Cosmos DB",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Cosmos DB.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscSynapse",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Synapse",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Synapse.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscApps",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for AppServices",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for AppServices.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscStorage",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Storage",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Storage.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscSql",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Azure SQL Database",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Azure SQL Database.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscSqlOnVm",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for SQL servers on machines",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for SQL servers on machines.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscKeyVault",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Key Vault",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Key Vault.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscArm",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Azure Resource Manager",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Resource Manager.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscDns",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for DNS",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for DNS.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAscContainers",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Microsoft Defender for Containers (Kubernetes and Registries)",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Containers.",
                            "visible": "[equals(steps('esGovState').esAsc,'Yes')]",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "DeployIfNotExists"
                                    },
                                    {
                                        "label": "No",
                                        "value": "Disabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esSecuritySolution",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Microsoft Sentinel",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                        }
                    ]
                },
                {
                    "name": "esConnectivityGoalState",
                    "label": "Network Connectivity and Topology",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzGs",
                    "elements": [
                        {
                            "name": "multiPlatformConnectivitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]",
                            "options": {
                                "text": "To enable connectivity for Azure and on-premises, you must allocate a dedicated connectivity Subscription. Please note, this Subscription will be moved to the connectivity Management Group, and ARM will deploy the first hub virtual network for either a hub and spoke or Virtual WAN  network topology. Additional networking platform resources such as gateways or Azure Firewall can be deployed. We recommend using a new dedicated Subscription with no existing resources. When you need to scale-out networking, either into the same region and same subscription, or to a new region or a separate connectivity subscription, use the following link to deploy and scale-out.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/define-an-azure-network-topology",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "singlePlatformConnectivitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[equals(steps('lzSettings').subSection.subOrgsOption, 'Single')]",
                            "options": {
                                "text": "To enable network topology and connectivity for Azure and on-premises, you can select the preferred networking topology, and deploy this into the dedicated platform subscription. Additional networking platform resources such as gateways or Azure Firewall can also be deployed.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/define-an-azure-network-topology",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "connSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure Connectivity Configuration",
                            "elements": [
                                {
                                    "name": "azMonText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "The AfO Landing Zones provides the foundational networking and connectivity services for deploying telco applications and services on Microsoft Azure at scale. Select the preferred networking topology and services for Azure and the Distributed Edge.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/blob/main/telco/docs/telco-networking.md"
                                        }
                                    }
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "esHub",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy networking topology for Azure and on-premises",
                            "defaultValue": "No",
                            "toolTip": "Select the preferred network topology. If third-party NVA is a requirement, you must deploy this into the connectivity subscription post the deployment.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Hub and spoke (customer managed)",
                                        "value": "vhub"
                                    },
                                    {
                                        "label": "Virtual WAN (Microsoft managed)",
                                        "value": "vwan"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esNwSubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Connectivity subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esNwSub",
                                    "label": "Connectivity subscription"
                                }
                            ],
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single')))]"
                        },
                        {
                            "name": "esAddressHubVWAN",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Address space (required for vWAN hub)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/23)",
                            "defaultValue": "10.100.0.0/23",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), not(equals(steps('esConnectivityGoalState').esHub, 'nva')), not(equals(steps('esConnectivityGoalState').esHub, 'vhub')))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(1[0-9]|2[0-4]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [10,24]."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressHubHS",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Address space (required for hub virtual network)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/16)",
                            "defaultValue": "10.100.0.0/16",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), not(equals(steps('esConnectivityGoalState').esHub, 'vwan')))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(1[0-9]|2[0-4]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [10,24]."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esLocationsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "locations?api-version=2019-11-01"
                            }
                        },
                        {
                            "name": "esNwLocation",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Region for the first networking hub",
                            "filter": true,
                            "toolTip": "Select the target region for you connectivity deployment (requires you to provide a subscriptionId for connectivity)",
                            "constraints": {
                                "allowedValues": "[map(steps('esConnectivityGoalState').esLocationsApi.value,(item) => parse(concat('{\"label\":\"',item.displayName,'\",\"value\":\"',item.name,'\"}')))]",
                                "required": true
                            },
                            "visible": "[not(equals(steps('esConnectivityGoalState').esHub, 'No'))]"
                        },
                        {
                            "name": "anmSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Enable VNet connectivity with Azure Virtual Network Manager",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esHub, 'vhub'), contains(split('northcentrals,westus2,eastus,eastus2,northeurope,westeurope,francecentral', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "elements": [
                                {
                                    "name": "anmText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Azure Virtual Network Manager (Preview) is a management service that enables you to group, configure, deploy, and manage virtual networks globally across subscriptions.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/virtual-network-manager/overview"
                                        }
                                    }
                                },
                                {
                                    "name": "anmOption",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Use Azure Virtual Network Manager to manage virtual networks",
                                    "defaultValue": "No",
                                    "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will create an Azure Virtual Network Manager instance in the connectivity subscription.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": true
                                }
                            ]
                        },
                        {
                            "name": "esPrivateDns",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Create Private DNS Zones for Azure PaaS services",
                            "defaultValue": "Yes (recommended)",
                            "visible": "[equals(steps('esConnectivityGoalState').esHub, 'vhub')]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will create Private DNS Zones for Azure PaaS services",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esPrivateDnsResolver",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Private DNS resolver",
                            "defaultValue": "Yes (Recommended)",
                            "visible": "[equals(steps('esConnectivityGoalState').esHub, 'vhub')]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will enable Azure Firewall as a DNS Proxy.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (Recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "Yes (Inbound only)",
                                        "value": "Inbound"
                                    },
                                    {
                                        "label": "Yes (Outbound only)",
                                        "value": "Outbound"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "subnetMaskPrivateDnsResolverInbound",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for DNS Resolver (inbound)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.3.0/24)",
                            "defaultValue": "10.100.2.0/24",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esPrivateDnsResolver, 'Yes'), equals(steps('esConnectivityGoalState').esPrivateDnsResolver, 'Inbound'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-8]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,28]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverInbound, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverInbound, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverInbound, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), last(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverInbound, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "subnetMaskPrivateDnsResolverOutbound",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for DNS Resolver (outbound)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.3.0/24)",
                            "defaultValue": "10.100.3.0/24",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esPrivateDnsResolver, 'Yes'), equals(steps('esConnectivityGoalState').esPrivateDnsResolver, 'Outbound'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-8]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,28]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverOutbound, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverOutbound, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverOutbound, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), last(split(steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverOutbound, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esVpnGw",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy VPN Gateway",
                            "defaultValue": "No",
                            "visible": "[not(equals(steps('esConnectivityGoalState').esHub, 'No'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy VPN gateway",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esGwRegionalOrAz",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy zone redundant or regional VPN Gateway",
                            "defaultValue": "Zone redundant (recommended)",
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esVpnGw,'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))), equals(steps('esConnectivityGoalState').esVpnGw,'Yes'),contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Virtual Gateway to the selected region and availability zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Zone redundant (recommended)",
                                        "value": "Zone"
                                    },
                                    {
                                        "label": "Regional",
                                        "value": "Regional"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esGwNoAzSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the VPN Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))), equals(steps('esConnectivityGoalState').esVpnGw,'Yes'), not(contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation)))]",
                            "toolTip": "Select the required SKU for the VPN gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "VpnGw2",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 500 IKEv2/OpenVPN connections, aggregate throughput is 1.25 Gbps",
                                        "value": "VpnGw2"
                                    },
                                    {
                                        "label": "VpnGw3",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 1000 IKEv2/OpenVPN connections, aggregate throughput is 2.5 Gbps",
                                        "value": "VpnGw3"
                                    },
                                    {
                                        "label": "VpnGw4",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 5000 IKEv2/OpenVPN connections, aggregate throughput is 5 Gbps",
                                        "value": "VpnGw4"
                                    },
                                    {
                                        "label": "VpnGw5",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 10000 IKEv2/OpenVPN connections, aggregate throughput is 10 Gbps",
                                        "value": "VpnGw5"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esGwAzSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the VPN Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))), equals(steps('esConnectivityGoalState').esVpnGw,'Yes'), equals(steps('esConnectivityGoalState').esGwRegionalOrAz, 'Zone') ,contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "Select the required SKU for the VPN gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "VpnGw2AZ",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 500 IKEv2/OpenVPN connections, aggregate throughput is 1.25 Gbps",
                                        "value": "VpnGw2AZ"
                                    },
                                    {
                                        "label": "VpnGw3AZ",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 1000 IKEv2/OpenVPN connections, aggregate throughput is 2.5 Gbps",
                                        "value": "VpnGw3AZ"
                                    },
                                    {
                                        "label": "VpnGw4AZ",
                                        "description": "Supports BGP, max 100 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 5000 IKEv2/OpenVPN connections, aggregate throughput is 5 Gbps",
                                        "value": "VpnGw4AZ"
                                    },
                                    {
                                        "label": "VpnGw5AZ",
                                        "description": "Supports BGP, max 100 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 10000 IKEv2/OpenVPN connections, aggregate throughput is 10 Gbps",
                                        "value": "VpnGw5AZ"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esGwRegionalSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the VPN Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))), equals(steps('esConnectivityGoalState').esVpnGw,'Yes'), equals(steps('esConnectivityGoalState').esGwRegionalOrAz, 'Regional') ,contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "Select the required SKU for the VPN gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "VpnGw2",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 500 IKEv2/OpenVPN connections, aggregate throughput is 1.25 Gbps",
                                        "value": "VpnGw2"
                                    },
                                    {
                                        "label": "VpnGw3",
                                        "description": "Supports BGP, max 30 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 1000 IKEv2/OpenVPN connections, aggregate throughput is 2.5 Gbps",
                                        "value": "VpnGw3"
                                    },
                                    {
                                        "label": "VpnGw4",
                                        "description": "Supports BGP, max 100 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 5000 IKEv2/OpenVPN connections, aggregate throughput is 5 Gbps",
                                        "value": "VpnGw4"
                                    },
                                    {
                                        "label": "VpnGw5",
                                        "description": "Supports BGP, max 100 S2S/VNet-VNet tunnels, max 128 P2S SSTP connections, max 10000 IKEv2/OpenVPN connections, aggregate throughput is 10 Gbps",
                                        "value": "VpnGw5"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esVwanGwScaleUnits",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the VPN Gateway scale unit",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "Select the VPN Gateway scale unit",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "1 scale unit",
                                        "description": "Supports 500 Mbps x2",
                                        "value": "1"
                                    },
                                    {
                                        "label": "2 scale units",
                                        "description": "Supports 1 Gbps x 2",
                                        "value": "2"
                                    },
                                    {
                                        "label": "3 scale units",
                                        "description": "Supports 1.5 Gbps x 2",
                                        "value": "3"
                                    },
                                    {
                                        "label": "4 scale units",
                                        "description": "Supports 2 Gbps x 2",
                                        "value": "4"
                                    },
                                    {
                                        "label": "5 scale units",
                                        "description": "Supports 2.5 Gbps x 2",
                                        "value": "5"
                                    },
                                    {
                                        "label": "6 scale units",
                                        "description": "Supports 3 Gbps x 2",
                                        "value": "6"
                                    },
                                    {
                                        "label": "7 scale units",
                                        "description": "Supports 3.5 Gbps x 2",
                                        "value": "7"
                                    },
                                    {
                                        "label": "8 scale units",
                                        "description": "Supports 4 Gbps x 2",
                                        "value": "8"
                                    },
                                    {
                                        "label": "9 scale units",
                                        "description": "Supports 4.5 Gbps x 2",
                                        "value": "9"
                                    },
                                    {
                                        "label": "10 scale units",
                                        "description": "Supports 5 Gbps x 2",
                                        "value": "10"
                                    },
                                    {
                                        "label": "11 scale units",
                                        "description": "Supports 5.5 Gbps x 2",
                                        "value": "11"
                                    },
                                    {
                                        "label": "12 scale units",
                                        "description": "Supports 6 Gbps x 2",
                                        "value": "12"
                                    },
                                    {
                                        "label": "13 scale units",
                                        "description": "Supports 6.5 Gbps x 2",
                                        "value": "13"
                                    },
                                    {
                                        "label": "14 scale units",
                                        "description": "Supports 7 Gbps x 2",
                                        "value": "14"
                                    },
                                    {
                                        "label": "15 scale units",
                                        "description": "Supports 7.5 Gbps x 2",
                                        "value": "15"
                                    },
                                    {
                                        "label": "16 scale units",
                                        "description": "Supports 8 Gbps x 2",
                                        "value": "16"
                                    },
                                    {
                                        "label": "17 scale units",
                                        "description": "Supports 8.5 Gbps x 2",
                                        "value": "17"
                                    },
                                    {
                                        "label": "18 scale units",
                                        "description": "Supports 9 Gbps x 2",
                                        "value": "18"
                                    },
                                    {
                                        "label": "19 scale units",
                                        "description": "Supports 9.5 Gbps x 2",
                                        "value": "19"
                                    },
                                    {
                                        "label": "20 scale units",
                                        "description": "Supports 10 Gbps x 2",
                                        "value": "20"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressVpnOrEr",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for VPN/ExpressRoute Gateways",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.1.0/24)",
                            "defaultValue": "10.100.1.0/24",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'vwan')), or(equals(steps('esConnectivityGoalState').esErGw, 'Yes'),equals(steps('esConnectivityGoalState').esVpnGw, 'Yes')))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-7]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,27]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressVpnOrEr, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressVpnOrEr, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressVpnOrEr, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), last(split(steps('esConnectivityGoalState').esAddressVpnOrEr, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esErGw",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy ExpressRoute Gateway",
                            "defaultValue": "No",
                            "visible": "[not(equals(steps('esConnectivityGoalState').esHub, 'No'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy ExpressRoute gateway",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esErRegionalOrAz",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy zone redundant or regional ExpressRoute Gateway",
                            "defaultValue": "Zone redundant (recommended)",
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))),equals(steps('esConnectivityGoalState').esErGw,'Yes'),contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Express Route Gateway to the selected region and availability zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Zone redundant (recommended)",
                                        "value": "Zone"
                                    },
                                    {
                                        "label": "Regional",
                                        "value": "Regional"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esErAzSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the ExpressRoute Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))),equals(steps('esConnectivityGoalState').esErGw,'Yes'), equals(steps('esConnectivityGoalState').esErRegionalOrAz, 'Zone'), contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "Select the required SKU for the Express Route gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "ErGw1AZ",
                                        "description": "Megabits per second 1000, packets per second 100,000, connections per second 7000, max number of cicuit connections is 4",
                                        "value": "ErGw1AZ"
                                    },
                                    {
                                        "label": "ErGw2AZ",
                                        "description": "Megabits per second 2000, packets per second 250,000, connections per second 14000, max number of cicuit connections is 8",
                                        "value": "ErGw2AZ"
                                    },
                                    {
                                        "label": "ErGw3AZ",
                                        "description": "Megabits per second 10,000, packets per second 1,000,000, connections per second 28,000, max number of cicuit connections is 16",
                                        "value": "ErGw3AZ"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esErRegionalSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the ExpressRoute Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))), equals(steps('esConnectivityGoalState').esErGw,'Yes'), equals(steps('esConnectivityGoalState').esErRegionalOrAz, 'Regional'), contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation))]",
                            "toolTip": "Select the required SKU for the Express Route gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Standard",
                                        "description": "Megabits per second 1000, packets per second 100,000, connections per second 7000, max number of cicuit connections is 4",
                                        "value": "Standard"
                                    },
                                    {
                                        "label": "HighPerformance",
                                        "description": "Megabits per second 2000, packets per second 250,000, connections per second 14000, max number of cicuit connections is 8",
                                        "value": "HighPerformance"
                                    },
                                    {
                                        "label": "UltraPerformance",
                                        "description": "Megabits per second 10,000, packets per second 1,000,000, connections per second 28,000, max number of cicuit connections is 16",
                                        "value": "UltraPerformance"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esErNoAzSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the ExpressRoute Gateway SKU",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(and(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan'))),equals(steps('esConnectivityGoalState').esErGw,'Yes'), not(contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation)))]",
                            "toolTip": "Select the required SKU for the Express Route gateway.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Standard",
                                        "description": "Megabits per second 1000, packets per second 100,000, connections per second 7000, max number of cicuit connections is 4",
                                        "value": "Standard"
                                    },
                                    {
                                        "label": "HighPerformance",
                                        "description": "Megabits per second 2000, packets per second 250,000, connections per second 14000, max number of cicuit connections is 8",
                                        "value": "HighPerformance"
                                    },
                                    {
                                        "label": "UltraPerformance",
                                        "description": "Megabits per second 10,000, packets per second 1,000,000, connections per second 28,000, max number of cicuit connections is 16",
                                        "value": "UltraPerformance"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esVwanErScaleUnits",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select the ExpressRoute Gateway scale unit",
                            "defaultValue": "",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[and(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "Select the ExpressRoute Gateway scale unit",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "1 scale unit",
                                        "description": "Supports 2 Gbps",
                                        "value": "1"
                                    },
                                    {
                                        "label": "2 scale units",
                                        "description": "Supports 4 Gbps",
                                        "value": "2"
                                    },
                                    {
                                        "label": "3 scale units",
                                        "description": "Supports 6 Gbps",
                                        "value": "3"
                                    },
                                    {
                                        "label": "4 scale units",
                                        "description": "Supports 8 Gbps",
                                        "value": "4"
                                    },
                                    {
                                        "label": "5 scale units",
                                        "description": "Supports 10 Gbps",
                                        "value": "5"
                                    },
                                    {
                                        "label": "6 scale units",
                                        "description": "Supports 12 Gbps",
                                        "value": "6"
                                    },
                                    {
                                        "label": "7 scale units",
                                        "description": "Supports 14 Gbps",
                                        "value": "7"
                                    },
                                    {
                                        "label": "8 scale units",
                                        "description": "Supports 16 Gbps",
                                        "value": "8"
                                    },
                                    {
                                        "label": "9 scale units",
                                        "description": "Supports 18 Gbps",
                                        "value": "9"
                                    },
                                    {
                                        "label": "10 scale units",
                                        "description": "Supports 20 Gbps",
                                        "value": "10"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFw",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Azure Firewall",
                            "defaultValue": "Yes (recommended)",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esHub, 'vhub'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwDns",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Azure Firewall as a DNS proxy",
                            "defaultValue": "No",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esPrivateDnsResolver, 'No'), equals(steps('esConnectivityGoalState').esHub, 'vhub'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will enable Azure Firewall as a DNS Proxy.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwSku",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Azure Firewall tier",
                            "defaultValue": "Standard",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[equals(steps('esConnectivityGoalState').esAzFw, 'Yes')]",
                            "toolTip": "Select Azure Firewall tier",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Standard",
                                        "description": "Standard Azure Firewall",
                                        "value": "Standard"
                                    },
                                    {
                                        "label": "Premium",
                                        "description": "Premium Azure Firewall adds support for TLS inspection, IDPS, URL filtering and web categories.",
                                        "value": "Premium"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esFwAz",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Availability Zones for the Azure Firewall",
                            "defaultValue": "None",
                            "multiselect": true,
                            "selectAll": true,
                            "filter": true,
                            "visible": "[if(equals(steps('esConnectivityGoalState').esHub, 'vhub'), and(equals(steps('esConnectivityGoalState').esAzFw,'Yes'), contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation)), false)]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall to the selected region and availability zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Zone 1",
                                        "value": "1"
                                    },
                                    {
                                        "label": "Zone 2",
                                        "value": "2"
                                    },
                                    {
                                        "label": "Zone 3",
                                        "value": "3"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressFw",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for Azure Firewall",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/24)",
                            "defaultValue": "10.100.0.0/24",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esAzFw, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub, 'vwan')))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFw, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFw, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFw, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), last(split(steps('esConnectivityGoalState').esAddressFw, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esForcedTunneling",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Forced Tunneling",
                            "defaultValue": "No",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esHub, 'vhub'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, you can optionally add dedicated subscription for ingess and egress",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressFwMgmt",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for Azure Firewall Management",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/24)",
                            "defaultValue": "10.100.10.0/24",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esAzFw, 'Yes'), not(equals(steps('esConnectivityGoalState').esForcedTunneling, 'No')))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwMgmt, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwMgmt, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwMgmt, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressHubHS, '/')), last(split(steps('esConnectivityGoalState').esAddressFwMgmt, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esDedicatedInboundSub",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Use a dedicated subscription for Internet ingress",
                            "defaultValue": "No",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esHub, 'vhub'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, you can optionally add dedicated subscription for ingess and egress",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esNwAdditionalSubSectionIngress",
                            "type": "Microsoft.Common.Section",
                            "label": "Internet ingress subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esNwIngress",
                                    "label": "Ingress subscription"
                                }
                            ],
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedInboundSub, 'Yes'))]"
                        },
                        {
                            "name": "esAddressIngress",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Address space (required for the virtual network)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.200.0.0/16)",
                            "defaultValue": "10.200.0.0/16",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedInboundSub, 'Yes'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwIngress",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Azure Firewall",
                            "defaultValue": "Yes (recommended)",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedInboundSub, 'Yes'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, Azure Firewall will be created using the same configuration as used in the connectivity hub",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressFwIngress",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for Azure Firewall for ingress",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.200.0.0/24)",
                            "defaultValue": "10.200.0.0/24",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esAzFwIngress, 'Yes'), equals(steps('esConnectivityGoalState').esDedicatedInboundSub, 'Yes'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressIngress, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressIngress, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwIngress, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressIngress, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressIngress, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwIngress, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressIngress, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressIngress, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwIngress, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressIngress, '/')), last(split(steps('esConnectivityGoalState').esAddressFwIngress, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwSkuIngress",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Azure Firewall tier",
                            "defaultValue": "Standard",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[equals(steps('esConnectivityGoalState').esAzFwIngress, 'Yes')]",
                            "toolTip": "Select Azure Firewall tier",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Standard",
                                        "description": "Standard Azure Firewall",
                                        "value": "Standard"
                                    },
                                    {
                                        "label": "Premium",
                                        "description": "Premium Azure Firewall adds support for TLS inspection, IDPS, URL filtering and web categories.",
                                        "value": "Premium"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esFwAzIngress",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Availability Zones for the Azure Firewall",
                            "defaultValue": "None",
                            "multiselect": true,
                            "selectAll": true,
                            "filter": true,
                            "visible": "[if(equals(steps('esConnectivityGoalState').esDedicatedInboundSub, 'Yes'), and(equals(steps('esConnectivityGoalState').esAzFwIngress,'Yes'), contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation)), false)]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall to the selected region and availability zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Zone 1",
                                        "value": "1"
                                    },
                                    {
                                        "label": "Zone 2",
                                        "value": "2"
                                    },
                                    {
                                        "label": "Zone 3",
                                        "value": "3"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esDedicatedOutboundSub",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Use a dedicated subscription for Internet egress",
                            "defaultValue": "No",
                            "visible": "[or(equals(steps('esConnectivityGoalState').esHub, 'vhub'), equals(steps('esConnectivityGoalState').esHub, 'vwan'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, you can optionally add dedicated subscription for ingess and egress",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esNwAdditionalSubSectionEgress",
                            "type": "Microsoft.Common.Section",
                            "label": "Internet egress subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esNwEgress",
                                    "label": "Internet egress subscription"
                                }
                            ],
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedOutboundSub, 'Yes'))]"
                        },
                        {
                            "name": "esAddressEgress",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Address space (required for the virtual network)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.210.0.0/16)",
                            "defaultValue": "10.210.0.0/16",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedOutboundSub, 'Yes'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwEgress",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy Azure Firewall",
                            "defaultValue": "Yes (recommended)",
                            "visible": "[and(not(equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esDedicatedOutboundSub, 'Yes'))]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, Azure Firewall will be created using the same configuration as used in the connectivity hub",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAddressFwEgress",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Subnet for Azure Firewall for egress",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.210.0.0/24)",
                            "defaultValue": "10.210.0.0/24",
                            "visible": "[and(equals(steps('esConnectivityGoalState').esAzFwEgress, 'Yes'), equals(steps('esConnectivityGoalState').esDedicatedOutboundSub, 'Yes'))]",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(2[0-6]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [20,26]."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressEgress, '/')), 8), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressEgress, '/')), '.'), 1)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwEgress, '/')), '.'), 1))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (first octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressEgress, '/')), 16), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressEgress, '/')), '.'), 2)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwEgress, '/')), '.'), 2))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (second octet)."
                                    },
                                    {
                                        "isValid": "[if(greaterOrEquals(last(split(steps('esConnectivityGoalState').esAddressEgress, '/')), 24), equals(last(take(split(first(split(steps('esConnectivityGoalState').esAddressEgress, '/')), '.'), 3)), last(take(split(first(split(steps('esConnectivityGoalState').esAddressFwEgress, '/')), '.'), 3))), true)]",
                                        "message": "CIDR range not within virtual network CIDR range (third octet)."
                                    },
                                    {
                                        "isValid": "[lessOrEquals(last(split(steps('esConnectivityGoalState').esAddressEgress, '/')), last(split(steps('esConnectivityGoalState').esAddressFwEgress, '/')))]",
                                        "message": "CIDR range not within virtual network CIDR range (subnet mask)."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esAzFwSkuEgress",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Azure Firewall tier",
                            "defaultValue": "Standard",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": false,
                            "multiLine": true,
                            "visible": "[equals(steps('esConnectivityGoalState').esAzFwEgress, 'Yes')]",
                            "toolTip": "Select Azure Firewall tier",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Standard",
                                        "description": "Standard Azure Firewall",
                                        "value": "Standard"
                                    },
                                    {
                                        "label": "Premium",
                                        "description": "Premium Azure Firewall adds support for TLS inspection, IDPS, URL filtering and web categories.",
                                        "value": "Premium"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esFwAzEgress",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Select Availability Zones for the Azure Firewall",
                            "defaultValue": "None",
                            "multiselect": true,
                            "selectAll": true,
                            "filter": true,
                            "visible": "[if(equals(steps('esConnectivityGoalState').esDedicatedOutboundSub, 'Yes'), and(equals(steps('esConnectivityGoalState').esAzFwEgress,'Yes'), contains(split('canadacentral,centralus,eastus,eastus2,southcentralus,westus2,francecentral,germanywestcentral,northeurope,westeurope,uksouth,southafricanorth,japaneast,southeastasia,australiaeast', ','), steps('esConnectivityGoalState').esNwLocation)), false)]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall to the selected region and availability zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Zone 1",
                                        "value": "1"
                                    },
                                    {
                                        "label": "Zone 2",
                                        "value": "2"
                                    },
                                    {
                                        "label": "Zone 3",
                                        "value": "3"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esBgpCommunity",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable BGP Community for the virtual network",
                            "defaultValue": "No",
                            "visible": "[equals(steps('esConnectivityGoalState').esHub, 'vhub')]",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, BGP Community will be enabled for the virtual network.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "esBgpString",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Provide the BGP Community string",
                            "toolTip": "The community string must start with '12076:'. You can set a community value between 20000 and 49999",
                            "defaultValue": "12076:20000",
                            "visible": "[equals(steps('esConnectivityGoalState').esBgpCommunity, 'Yes')]",
                            "constraints": {
                                "required": true,
                                "validations": []
                            }
                        },
                        {
                            "name": "nwSecurity",
                            "type": "Microsoft.Common.Section",
                            "label": "Network Security and Monitoring",
                            "elements": [
                                {
                                    "name": "monitoring",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]",
                                    "options": {
                                        "text": "Select which Azure Network Security and Monitoring solutions you will enable for your platform and landing zones",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                                        }
                                    }
                                },
                                {
                                    "name": "esDdoS",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Enable DDoS Protection",
                                    "defaultValue": "Yes, DDoS Network Protection (recommended)",
                                    "visible": "[not(equals(steps('esConnectivityGoalState').esHub, 'No'))]",
                                    "toolTip": "If 'Yes' is selected when also adding a connectivity subscription, DDoS Network Protection will be enabled and protect your Azure resources from denial of service threats.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes, DDoS Network Protection (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "Yes, DDoS Network Protection per individual public IP addresses",
                                                "value": "Pip"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "esNetworkWatcher",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Enable Network Watcher observability",
                                    "defaultValue": "Yes (recommended)",
                                    "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]",
                                    "toolTip": "If 'Yes' is selected when also adding a connectivity subscription, Network Watcher will be enabled for all virtual networks for the platform and the landing zones.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "esNsgFlowLogs",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Enable NSG Flow Logs and Traffic Analytics",
                                    "defaultValue": "Yes (recommended)",
                                    "visible": "[and(equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes'), equals(steps('esConnectivityGoalState').nwSecurity.esNetworkWatcher, 'Yes'))]",
                                    "toolTip": "If 'Yes' is selected when also adding a connectivity subscription, NSG Flow Logs will be enabled for all NSGs for the platform and the landing zones.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "exemptionInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[and(equals(steps('esConnectivityGoalState').nwSecurity.esNsgFlowLogs, 'Yes'), equals(steps('esGoalState').mcsbPolicy, 'Yes'))]",
                                    "options": {
                                        "icon": "Info",
                                        "text": "NSG Flow Logs requires a storage account accessible over a public endpoint, that will be created in the management subscription only trusting known Azure services. A policy exemption will be created to bypass the Microsoft Cloud Security Benchmark recommendations for the storage account.",
                                        "uri": "https://www.microsoft.com"
                                    }
                                }
                            ],
                            "visible": "[equals(steps('esGoalState').azMonSection.esLogAnalytics,'Yes')]"
                        }
                    ]
                },
                {
                    "name": "esIdentityGoalState",
                    "label": "Identity and Access",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzGs",
                    "elements": [
                        {
                            "name": "multiPlatformIdentitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]",
                            "options": {
                                "text": "To enable identity (AuthN/AuthZ) for workloads in landing zones, you must allocate an identity Subscription that is dedicated to host your Active Directory domain controllers. Please note, this Subscription will be moved to the identity Management Group, and ARM will assign the selected policies. We recommend using a new Subscription with no existing resources.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/identity-and-access-management",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "singlePlatformIdentitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[equals(steps('lzSettings').subSection.subOrgsOption, 'Single')]",
                            "options": {
                                "text": "To enable identity (AuthN/AuthZ) for workloads in landing zones, it is recommended to assign specific policies to govern the virtual machines used for Active Directory domain controllers.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/identity-and-access-management",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "authNauthZsection",
                            "type": "Microsoft.Common.Section",
                            "label": "Authentication and Authorization for workloads",
                            "elements": [],
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]"
                        },
                        {
                            "name": "authNauthZtexts",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]",
                            "options": {
                                "text": "You can optionally bring in a dedicated subscription for identity, which will serve as a placeholder for your domain controller virtual machines. Select 'No' if you want to do this later.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                                }
                            }
                        },
                        {
                            "name": "identitySub",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Configure dedicated Identity subscription",
                            "defaultValue": "No",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, Azure Policy will be assigned at the scope to govern your identity resources.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "[not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]"
                        },
                        {
                            "name": "esIdentitySubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Identity subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esIdentitySub",
                                    "label": "Management subscription"
                                }
                            ],
                            "visible": "[and(not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single')), equals(steps('esIdentityGoalState').identitySub,'Yes'))]"
                        },
                        {
                            "name": "esIdentityGovSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Identity Governance",
                            "elements": [],
                            "visible": true
                        },
                        {
                            "name": "identitypolicies",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Select which of the the recommended policies you will assign to your identity management group.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                                }
                            }
                        },
                        {
                            "name": "esIdDenyRdp",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Prevent inbound RDP from internet",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent inbound RDP from internet",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esIdDenySubnetNsg",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Ensure subnets are associated with NSG",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure NSGs must be associated with subnets being created",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esIdDenyPublicIp",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Prevent usage of public IP",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure public IP resources cannot be created",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "not(equals(steps('lzSettings').subSection.subOrgsOption, 'Single'))]"
                        },
                        {
                            "name": "esIdAzBackup",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Ensure Azure VMs (Windows & Linux) are enabled for Azure Backup",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and enable Azure Backup on all VMs in the landing zones.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esIdentityConnectivity",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Create virtual network and connect to the connectivity hub (optional)?",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected for corp landing zones, ARM will connect the subscriptions to the hub virtual network via VNet peering.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": "[and(equals(steps('esIdentityGoalState').identitySub, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub,'No')))]"
                        },
                        {
                            "name": "esIdentityCidr",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Virtual network address space",
                            "placeholder": "",
                            "defaultValue": "10.110.0.0/24",
                            "toolTip": "The virtual network's address space, specified as one address prefixes in CIDR notation (e.g. 192.168.1.0/24)",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(1[0-9]|2[0-9]))$",
                                        "message": "Invalid CIDR range. The address prefix must be in the range [10,29]."
                                    }
                                ]
                            },
                            "visible": "[and(equals(steps('esIdentityGoalState').esIdentityConnectivity, 'Yes'), not(equals(steps('esConnectivityGoalState').esHub,'No')))]"
                        }
                    ]
                },
                {
                    "name": "esPlayground",
                    "label": "Playground",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "playExplore",
                    "elements": [
                        {
                            "name": "playgroundInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "To accelerate innovation and transformation, subscriptions can be moved into the playground management group, completely separated from everything else where developers can explore Azure services, collaborate, and innovate quicker in a safe and reliable way. Further, subscriptions in Playground management group can be used to expedite service enablement, to validate Azure services against best practices such as Microsoft Cloud Security Benchmark to ensure they can meet the compliance before being deployed to a landing zone.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/identity-and-access-management",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "playgroundText",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Select the subscriptions you want to move to playground management group.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#subscription-democratization"
                                }
                            }
                        },
                        {
                            "name": "playgroundApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "subscriptions?api-version=2020-01-01"
                            }
                        },
                        {
                            "name": "playgroundSub",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Playground subscriptions (optional)",
                            "toolTip": "",
                            "multiselect": true,
                            "selectAll": true,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": true,
                            "visible": true,
                            "constraints": {
                                "allowedValues": "[map(filter(steps('esPlayground').playgroundApi.value, (sub) => equals(sub.state, 'Enabled')), (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                                "required": false
                            }
                        },
                        {
                            "name": "playgroundPolicySection",
                            "type": "Microsoft.Common.Section",
                            "label": "Assign recommended Azure policies for playground subscriptions",
                            "elements": []
                        },
                        {
                            "name": "playgroundPolicyText",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Select which of the recommended policies you will assign to your playground subscriptions. The policies listed here will ensure that the boundaries between playground and landing zones can be crossed.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://placeholder.com"
                                }
                            }
                        },
                        {
                            "name": "vnetPeeringPolicy",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Prevent any Virtual Network Peering to and from the playground subscriptions",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, Azure Policy will be assigned at the scope to govern your playground resources.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "budgetPolicy",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Ensure there is a budget associated with each playground subscription to control cost",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, Azure Policy will be assigned at the scope to govern your playground resources.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "budgetAmount",
                            "type": "Microsoft.Common.Slider",
                            "min": 1000,
                            "max": 10000,
                            "label": "Specify monthly budget amount (subject to your currency)",
                            "subLabel": "",
                            "defaultValue": 1000,
                            "showStepMarkers": false,
                            "toolTip": "Select amount for the budget policy.",
                            "constraints": {
                                "required": false
                            },
                            "visible": "[equals(steps('esPlayground').budgetPolicy, 'Yes')]"
                        },
                        {
                            "name": "vnicPolicy",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Prevent network interfaces to have public IPs",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent usage of public IP for network interfaces",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "lzGoalState",
                    "label": "Landing Zones",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzGs",
                    "elements": [
                        {
                            "name": "infoBox1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "AfO Landing Zones enables secure by-default landing zones for workloads categorized as corp connected (e.g., connected to corporate network and enforcing private endpoints), cloud-native (e.g., workloads that can not communicate with the connectivity hub).",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "corpLz",
                            "type": "Microsoft.Common.Section",
                            "label": "Corp landing zones",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "corpText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscriptions you want to move to corp management group.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#subscription-democratization"
                                        }
                                    }
                                },
                                {
                                    "name": "esLzConnectivity",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Connect corp landing zones to the connectivity hub during the deployment (optional)?",
                                    "defaultValue": "No",
                                    "toolTip": "If 'Yes' is selected for corp landing zones, ARM will connect the subscriptions to the hub virtual network via VNet peering.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "Yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    },
                                    "visible": "[equals(steps('esConnectivityGoalState').esHub, 'vhub')]"
                                },
                                {
                                    "name": "lzCorpSubsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "esCorpLzSub",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Corp landing zone subscriptions (optional)",
                                    "toolTip": "",
                                    "multiselect": true,
                                    "selectAll": true,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "visible": "[or(or(equals(steps('lzGoalState').corpLz.esLzConnectivity, 'No'), equals(steps('esConnectivityGoalState').esHub, 'No')), equals(steps('esConnectivityGoalState').esHub, 'vwan'), equals(steps('lzGoalState').corpLz.esLzConnectivity, 'No'))]",
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('lzGoalState').corpLz.lzCorpSubsApi.value, (sub) => equals(sub.state, 'Enabled')), (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                                        "required": false
                                    }
                                },
                                {
                                    "name": "lzConnectedSubs",
                                    "type": "Microsoft.Common.EditableGrid",
                                    "ariaLabel": "Add existing subscriptions into the management group landing zone and provide address space for virtual network peering",
                                    "label": "Corp connected landing zone subscriptions (optional)",
                                    "visible": "[equals(steps('lzGoalState').corpLz.esLzConnectivity, 'Yes')]",
                                    "constraints": {
                                        "width": "Full",
                                        "rows": {
                                            "count": {
                                                "min": 1,
                                                "max": 10
                                            }
                                        },
                                        "columns": [
                                            {
                                                "id": "subs",
                                                "header": "Subscription",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "esLzConnectedSub",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "label": "Landing zone subscription",
                                                    "toolTip": "",
                                                    "multiselect": false,
                                                    "selectAll": false,
                                                    "filter": true,
                                                    "filterPlaceholder": "Filter items ...",
                                                    "multiLine": false,
                                                    "constraints": {
                                                        "allowedValues": "[map(steps('lzGoalState').corpLz.lzSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                                                        "required": false
                                                    }
                                                }
                                            },
                                            {
                                                "id": "addresses",
                                                "header": "Virtual Network Address space",
                                                "width": "1fr",
                                                "element": {
                                                    "type": "Microsoft.Common.TextBox",
                                                    "placeholder": "Ensure there are no overlapping IP addresses!",
                                                    "constraints": {
                                                        "required": true,
                                                        "validations": [
                                                            {
                                                                "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:/(1[0-9]|2[0-7]))$",
                                                                "message": "Invalid CIDR range. The address prefix must be in the range [10,27]."
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "lzSubsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "onlineLz",
                            "type": "Microsoft.Common.Section",
                            "label": "Cloud-native landing zones",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "onlineText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscriptions you want to move to the cloud-native management group.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#subscription-democratization"
                                        }
                                    }
                                },
                                {
                                    "name": "lzOnlineSubsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "esOnlineLzSub",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Cloud-native landing zone subscriptions (optional)",
                                    "toolTip": "",
                                    "multiselect": true,
                                    "selectAll": true,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "visible": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('lzGoalState').onlineLz.lzOnlineSubsApi.value, (sub) => equals(sub.state, 'Enabled')), (sub) => parse(concat('{\"label\":\"',sub.displayName,'\",\"description\":\"',sub.subscriptionId,'\",\"value\":\"',toLower(sub.subscriptionId),'\"}')))]",
                                        "required": false
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "industry": "telco",
                "subnetMaskForGw": "[steps('esConnectivityGoalState').esAddressVpnOrEr]",
                "subnetMaskForAzFw": "[steps('esConnectivityGoalState').esAddressFw]",
                "subnetMaskForAzFwMgmt": "[steps('esConnectivityGoalState').esAddressFwMgmt]",
                "enableErGw": "[steps('esConnectivityGoalState').esErGw]",
                "enableVpnGw": "[steps('esConnectivityGoalState').esVpnGw]",
                "enableHub": "[steps('esConnectivityGoalState').esHub]",
                "enableDdoS": "[steps('esConnectivityGoalState').nwSecurity.esDdoS]",
                "connectivitySubscriptionId": "[if(not(equals(steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId,steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId)),steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId,'')]",
                "enableAzFw": "[steps('esConnectivityGoalState').esAzFw]",
                "enableAzFwDnsProxy": "[steps('esConnectivityGoalState').esAzFwDns]",
                "addressPrefix": "[coalesce(steps('esConnectivityGoalState').esAddressHubVWAN, steps('esConnectivityGoalState').esAddressHubHS, '')]",
                "location": "[steps('esConnectivityGoalState').esNwLocation]",
                "managementSubscriptionId": "[steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId]",
                "identitySubscriptionId": "[if(or(not(equals(steps('esIdentityGoalState').esIdentitySubSection.esIdentitySub.subscriptionId,steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId)),not(equals(steps('esIdentityGoalState').esIdentitySubSection.esIdentitySub.subscriptionId,steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId))),steps('esIdentityGoalState').esIdentitySubSection.esIdentitySub.subscriptionId,'')]",
                "onlineLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').onlineLz.esOnlineLzSub,steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId)),not(contains(steps('lzGoalState').onlineLz.esOnlineLzSub,steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId))),steps('lzGoalState').onlineLz.esOnlineLzSub,'')]",
                "corpLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').corpLz.esCorpLzSub,steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId)),not(contains(steps('lzGoalState').corpLz.esCorpLzSub,steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId))),steps('lzGoalState').corpLz.esCorpLzSub,'')]",
                "enableLogAnalytics": "[steps('esGoalState').azMonSection.esLogAnalytics]",
                "enableMcsbPolicy": "[steps('esGovState').mcsbPolicy]",
                "denyRdpForIdentity": "[steps('esIdentityGoalState').esIdDenyRdp]",
                "denySubnetWithoutNsgForIdentity": "[steps('esIdentityGoalState').esIdDenySubnetNsg]",
                "denyPipForIdentity": "[steps('esIdentityGoalState').esIdDenyPublicIp]",
                "enableVmBackupForIdentity": "[steps('esIdentityGoalState').esIdAzBackup]",
                "enableDefenderEndpoint": "[steps('esGovState').defenderEndpoint]",
                "enableAsc": "[steps('esGovState').esAsc]",
                "emailContactAsc": "[steps('esGovState').esAscEmail]",
                "enableAscForServers": "[steps('esGovState').esAscVms]",
                "enableAscForCSPM": "[steps('esGovState').esAscCSPM]",
                "enableAscForApim": "[steps('esGovState').esAscApim]",
                "enableAscForCosmosDb": "[steps('esGovState').esAscCosmosDb]",
                "enableAscForSynapse": "[steps('esGovState').esAscSynapse]",
                "enableAscForOssDb": "[steps('esGovState').esAscOssDb]",
                "enableAscForAppServices": "[steps('esGovState').esAscApps]",
                "enableAscForStorage": "[steps('esGovState').esAscStorage]",
                "enableAscForSql": "[steps('esGovState').esAscSql]",
                "enableAscForSqlOnVm": "[steps('esGovState').esAscSqlOnVm]",
                "enableAscForKeyVault": "[steps('esGovState').esAscKeyVault]",
                "enableAscForArm": "[steps('esGovState').esAscArm]",
                "enableAscForDns": "[steps('esGovState').esAscDns]",
                "enableAscForContainers": "[steps('esGovState').esAscContainers]",
                "enableSecuritySolution": "[steps('esGovState').esSecuritySolution]",
                "enableAgentHealth": "[steps('esGoalState').azMonSection.esAgentSolution]",
                "enableChangeTracking": "[steps('esGoalState').azMonSection.esChangeTracking]",
                "enableUpdateMgmt": "[steps('esGoalState').azMonSection.esUpdateMgmt]",
                "enableActivityLog": "[steps('esGoalState').azMonSection.esActivityLog]",
                "enableVmInsights": "[steps('esGoalState').azMonSection.esVmInsights]",
                "enableServiceMap": "[steps('esGoalState').azMonSection.esServiceMap]",
                "dataExports": "[steps('esGoalState').azMonSection.esEventHubDataExports]",
                "denyVnetPeering": "[steps('esPlayground').vnetPeeringPolicy]",
                "enableBudget": "[steps('esPlayground').budgetPolicy]",
                "budgetAmount": "[string(steps('esPlayground').budgetAmount)]",
                "playgroundSubscriptionId": "[steps('esPlayground').playgroundSub]",
                "enableSqlAssessment": "[steps('esGoalState').azMonSection.esSqlAssessment]",
                "industryPrefix": "[steps('lzSettings').mgSection.esMgmtGroup]",
                "vpnOrErZones": "[steps('esConnectivityGoalState').esGwRegionalOrAz]",
                "firewallSku": "[steps('esConnectivityGoalState').esAzFwSku]",
                "firewallZones": "[steps('esConnectivityGoalState').esFwAz]",
                "gwRegionalOrAz": "[steps('esConnectivityGoalState').esGwRegionalOrAz]",
                "gwAzSku": "[steps('esConnectivityGoalState').esGwAzSku]",
                "gwRegionalSku": "[if(empty(steps('esConnectivityGoalState').esGwRegionalSku), steps('esConnectivityGoalState').esGwNoAzSku, steps('esConnectivityGoalState').esGwRegionalSku)]",
                "erRegionalOrAz": "[steps('esConnectivityGoalState').esErRegionalOrAz]",
                "erAzSku": "[steps('esConnectivityGoalState').esErAzSku]",
                "erRegionalSku": "[if(empty(steps('esConnectivityGoalState').esErRegionalSku), steps('esConnectivityGoalState').esErNoAzSku, steps('esConnectivityGoalState').esErRegionalSku)]",
                "singlePlatformSubscriptionId": "[steps('lzSettings').esSingleSubSection.esSingleSub.subscriptionId]",
                "retentionInDays": "[string(steps('esGoalState').azMonSection.esLogRetention)]",
                "expressRouteScaleUnit": "[steps('esConnectivityGoalState').esVwanErScaleUnits]",
                "vpnGateWayScaleUnit": "[steps('esConnectivityGoalState').esVwanGwScaleUnits]",
                "enablePrivateDnsZones": "[steps('esConnectivityGoalState').esPrivateDns]",
                "identityAddressPrefix": "[steps('esIdentityGoalState').esIdentityCidr]",
                "enableNetworkWatcher": "[steps('esConnectivityGoalState').nwSecurity.esNetworkWatcher]",
                "enableNsgFlowLogs": "[steps('esConnectivityGoalState').nwSecurity.esNsgFlowLogs]",
                "enableAvnm": "[steps('esConnectivityGoalState').anmSection.anmOption]",
                "compliantAzureServices": "[steps('esGovState').secureSvc]",
                "enablePrivateDnsResolver": "[steps('esConnectivityGoalState').esPrivateDnsResolver]",
                "subnetMaskForDnsResolverInbound": "[steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverInbound]",
                "subnetMaskForDnsResolverOutbound": "[steps('esConnectivityGoalState').subnetMaskPrivateDnsResolverOutbound]",
                "ingressSubscriptionId": "[steps('esConnectivityGoalState').esNwAdditionalSubSectionIngress.esNwIngress.subscriptionId]",
                "egressSubscriptionId": "[steps('esConnectivityGoalState').esNwAdditionalSubSectionEgress.esNwEgress.subscriptionId]",
                "addressPrefixIngress": "[steps('esConnectivityGoalState').esAddressIngress]",
                "addressPrefixEgress": "[steps('esConnectivityGoalState').esAddressEgress]",
                "enableAzFwIngress": "[steps('esConnectivityGoalState').esAzFwIngress]",
                "enableAzFwEgress": "[steps('esConnectivityGoalState').esAzFwEgress]",
                "subnetMaskForAzFwIngress": "[steps('esConnectivityGoalState').esAddressFwIngress]",
                "subnetMaskForAzFwEgress": "[steps('esConnectivityGoalState').esAddressFwEgress]",
                "firewallSkuIngress": "[steps('esConnectivityGoalState').esAzFwSkuIngress]",
                "firewallSkuEgress": "[steps('esConnectivityGoalState').esAzFwSkuEgress]",
                "firewallZonesIngress": "[steps('esConnectivityGoalState').esFwAzIngress]",
                "firewallZonesEgress": "[steps('esConnectivityGoalState').esFwAzEgress]",
                "bgpString": "[steps('esConnectivityGoalState').esBgpString]",
                "corpConnectedLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').corpLz.esCorpLzSub,steps('esGoalState').esMgmtSubSection.esMgmtSub.subscriptionId)),not(contains(steps('lzGoalState').corpLz.esCorpLzSub,steps('esConnectivityGoalState').esNwSubSection.esNwSub.subscriptionId))),steps('lzGoalState').corpLz.lzConnectedSubs,'')]"
            },
            "kind": "Tenant",
            "location": "[steps('basics').resourceScope.location.name]"
        }
    }
}